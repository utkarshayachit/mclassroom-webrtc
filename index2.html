<html>
  <head>
  <!--  <script src="http://webrtc.googlecode.com/svn/trunk/samples/js/base/adapter.js"></script> -->
    <script src="adapter.js"></script>
    <script src="http://code.jquery.com/jquery-2.0.3.js"></script>
    <script src="application.js"></script>
    <link rel="stylesheet" type="text/css" href="layout.css" />
    <script>
      $(document).ready(function (){
        var App = Classroom.getInstance();
        if (!App) {
          console.log("Browser not supported.");
          return;
        }

        // Update combo-boxes will list of available audio inputs.
        App.getAudioSources(function(inputMap) {
          var microphoneSelect = $("select#microphone");
          var tanpuraSelect = $("select#tanpura");

          // fill up combo-boxes with available input audio devices.
          $.each(inputMap, function(id, label) {
              microphoneSelect.append($("<option/>", {
                                          value: id,
                                          text: label
                                        }));
              tanpuraSelect.append($("<option/>", {
                                          value: id,
                                          text: label
                                        }));
          });
        });
        console.log("All is well.");
      });
    </script>
  </head>
  <body>
    <div id="container">
      <div id="header">
        <h1>Hindustani Classical Music Classroom</h1>
        <p>Online Hindustani classical music classroom designed for private
        lessons<p>
      </div>
      <div id="content">
        <h1>My Configuration</h1>
        <p>Select input and output devices to use for this session.</p>
        <p>
          <label>Select Microphone: </label>
          <select id="microphone">
            <option value="null">None</option>
          </select>
        </p>
        <p>
          <audio id="microphone"></audio>
        </p>
        <p>
          <label>Select Tanpura input (if applicable):</label>
          <select id="tanpura">
            <option value="null">None</option>
          </select>
        </p>
        <p>
          <audio id="tanpura"></audio>
        </p>
        <p><button id="start">Start</button></p>
      </div>
      <div id="footer">
        <p><b>Developed by: </b>Utkarsh Ayachit released under BSD with
        Attribution (Fedora License).
      </div>
    </div>
  </body>
  <script>
    $("button#start").click(function() {
      var self = $(this);
      if (self.text() === "Start") {
        console.log("Starting using user selections.");
        var microphoneId = $("select#microphone")[0].value;
        var tanpuraId = $("select#tanpura")[0].value;

        if (microphoneId === "null" && tanpuraId === "null") {
          console.log("Nothing selected, nothing to do.");
          return;
        }

        var App = Classroom.getInstance();
        if (microphoneId !== "null") {
          App.addAudioInput(microphoneId, function(item) {
            console.log("Microphone input setup.");
            // change button text.
            self.text("Stop");
            var mediaElement = $("audio#microphone")[0];
            mediaElement.src = window.URL.createObjectURL(item.webRTCStream)
            mediaElement.controls = true;
            mediaElement.play();
          });
        } else {
          console.log("No microphone input selected. Skipping.");
        }

        if (tanpuraId !== "null") {
          App.addAudioInput(tanpuraId, function(item) {
            console.log("Tanpura input setup.");
            // change button text.
            self.text("Stop");
            var mediaElement = $("audio#tanpura")[0];
            mediaElement.src = window.URL.createObjectURL(item.webRTCStream)
            mediaElement.controls = true;
            mediaElement.play();

          });
        } else {
          console.log("No tanpura input selected. Skipping.");
        }
      } else {
        //$("audio")[0].src = null;
        //self.text("Start");
      }
    });
  </script>
</html>
